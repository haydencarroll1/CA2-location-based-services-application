{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover, maximum-scale=5">
  <meta name="theme-color" content="#050505">
  <meta name="description" content="Explore Dublin's amenities with an interactive spatial map powered by PostGIS and GeoDjango">
  <!-- iOS standalone app settings -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <title>Dublin Amenities Explorer</title>
  
  <!-- Preconnect to external resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://basemaps.cartocdn.com">
  
  <!-- Modern Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  
  <!-- App CSS -->
  <link rel="stylesheet" href="{% static 'css/app.css' %}">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230ea5e9' rx='20' width='100' height='100'/><text x='50' y='68' text-anchor='middle' fill='white' font-size='45' font-weight='bold'>D</text></svg>">
</head>
<body>
  <!-- Initial loading state -->
  <div id="loadingPlaceholder" class="loading-placeholder">
    <div class="loading-placeholder__spinner"></div>
  </div>

  <header class="auth-bar">
    <div class="auth-bar__content">
      <a href="{% url 'map' %}" class="auth-bar__brand">
        <span class="auth-bar__logo">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
            <circle cx="12" cy="10" r="3"/>
          </svg>
        </span>
        <span class="auth-bar__brand-text">Dublin Explorer</span>
      </a>
      <div class="auth-bar__links">
        {% if request.user.is_authenticated %}
          <span class="auth-bar__user">{{ request.user.username }}</span>
          <a class="auth-link" href="{% url 'profile' %}">Profile</a>
          <a class="auth-link" href="{% url 'account_logout' %}?next=/">Logout</a>
        {% else %}
          <a class="auth-link" href="{% url 'account_login' %}">Login</a>
          <a class="auth-link auth-link--primary" href="{% url 'account_signup' %}">Sign up</a>
        {% endif %}
      </div>
      <!-- Mobile: compact account button in top-right -->
      {% if request.user.is_authenticated %}
        <a class="auth-bar__menu-btn" href="{% url 'profile' %}">Account</a>
      {% else %}
        <a class="auth-bar__menu-btn" href="{% url 'account_login' %}">Sign in</a>
      {% endif %}
    </div>
  </header>
  
  {% block content %}{% endblock %}
  
  <!-- Leaflet JS + feature modules -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="{% static 'js/routing.js' %}"></script>
  <script src="{% static 'js/weather.js' %}"></script>
  
  <script>
    // Hide loading placeholder when page is ready
    window.addEventListener('load', function() {
      setTimeout(function() {
        var placeholder = document.getElementById('loadingPlaceholder');
        if (placeholder) {
          placeholder.classList.add('hidden');
          setTimeout(function() { placeholder.remove(); }, 300);
        }
      }, 100);
    });

    (function() {
      var root = document.documentElement;
      var storedTheme = null;
      try {
        storedTheme = localStorage.getItem('theme');
      } catch (e) {
        storedTheme = null;
      }

      var prefersLight = false;
      if (window.matchMedia) {
        prefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
      }

      var metaTheme = document.querySelector('meta[name="theme-color"]');

      function applyTheme(theme) {
        root.dataset.theme = theme;
        if (metaTheme) {
          metaTheme.setAttribute('content', theme === 'light' ? '#f9fafb' : '#050505');
        }
        // Sync map base layer with theme if map is initialized
        if (window.updateMapTheme) {
          try {
            window.updateMapTheme(theme);
          } catch (e) {
            // ignore
          }
        }
        // Toggle icon visibility (works for both old and new class names)
        var toggle = document.getElementById('themeToggle');
        if (toggle) {
          var sunIcon = toggle.querySelector('.theme-icon--sun, .theme-toggle__icon--sun');
          var moonIcon = toggle.querySelector('.theme-icon--moon, .theme-toggle__icon--moon');
          if (sunIcon && moonIcon) {
            sunIcon.style.display = theme === 'light' ? 'none' : 'block';
            moonIcon.style.display = theme === 'light' ? 'block' : 'none';
          }
        }
      }

      var initialTheme = storedTheme || (prefersLight ? 'light' : 'dark');
      applyTheme(initialTheme);

      window.addEventListener('DOMContentLoaded', function() {
        var toggle = document.getElementById('themeToggle');
        if (!toggle) return;
        toggle.addEventListener('click', function() {
          var newTheme = root.dataset.theme === 'light' ? 'dark' : 'light';
          try {
            localStorage.setItem('theme', newTheme);
          } catch (e) {
            // ignore
          }
          applyTheme(newTheme);
        });
      });
    })();
  </script>
</body>
</html>
